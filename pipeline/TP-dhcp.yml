Objectif: |
  Obtenir l'attribution automatique d'une adresse ip via DHCP depuis plusieurs ordinateur derrière un switch branché au réseau
  Le routeur doit transmettre automatiquement les requêtes DHCP vers le serveur situé sur un autre réseau que l'ordinateur,
  grâce à la commande `ip helper-address [ip du serveur DHCP]`
  
---

Exercice:
  - Préparer le workspace Cisco:
    - ouvrir Packet Tracer
    - Packet Tracer:
      - File >> New
      - File >> Save as `tp-dhcp.pkt`
  - Préparer les éléments:
    - Router:
      - 2811:
        - Ajouter un routeur 2811 nommé Router0
    - Serveur:
      - Ajouter un serveur nommé DHCP
    - Machine:
      - Ajouter un PC nommé PC0
  - Établir les liaisons:
    - Ajouter la liaison PC0 (fa0) --> Routeur (fa/00)
    - Ajouter la liaison Routeur(fa0/1) --> DHCP(fa0)
  - Configurer:
    - Configurer le routeur Router0:
        - Configurer l'interface f0/1 du routeur Router0 (coté Serveur DHCP):
          - Router0 >> Config:
            - [Router0 >> Config >> FastEthernet0/1] Port Status on
            - Ip :
              - [Router0 >> Config >> FastEthernet0/1 >> IP Configuration] `192.168.1.1` `255.255.255.0`
          - Router0 >> CLI:
            - [Router0 >> CLI] `en`
            - [Router0 >> CLI] `conf t`
            - [Router0 >> CLI] `int f0/1`
            - [Router0 >> CLI] `ip helper-address 192.168.1.2` #ip helper-adress first occurence
        - Configurer l'interface fa0/0 du routeur Router0 (coté PC0):
          - Router0 >> Config:
            - [Router0 >> Config >> FastEthernet0/0] Port Status on
            - Ip:
              - Router0 >> Config >> FastEthernet0/0 >> IP Configuration] `192.168.0.1` `255.255.255.0`
          - Router0 >> CLI:
            - [Router0 >> CLI] `en`
            - [Router0 >> CLI] `conf t`
            - [Router0 >> CLI] `int f0/0`
            - [Router0 >> CLI] `ip helper-address 192.168.1.2` #ip helper-adress second occurence
    - Configurer le serveur DHCP:
      - Configurer l'interface f0 du serveur DHCP:
        - Router0 >> Config:
          - [DHCP >> Desktop >> IP Configuration] `192.168.1.2` `255.255.255.0`, gateway `192.168.1.1`
      - Démarrer le service DHCP:
        - DHCP >> Service >> DHCP:
          - [DHCP >> Services >> DHCP] Service on
          - [DHCP >> Services >> DHCP] Gateway `0.0.0.0`
          - [DHCP >> Services >> DHCP] Start IP Address `192.168.0.2` `255.255.255.0`
  - **Tester**:
    - Passer PC0 en mode DHCP:
      - Passer en mode Simulation
      - [PC0 >> Desktop >> IP configuration] Toggle Static --> DHCP pour déclencher une requête DHCP (action physique de l'utilisataur) 
      - Observer l'enchainement des paquets jusqu'à ce que PC0 obtienne une IP dans le range spécifié par le serveur DHCP
      - Re-passer en mode Realtime
  - Ajouter un switch:
    - Switch:
      - 2960:
        - Ajouter un switch 2960 nommé Switch0
        - Re-créer les liaisons:
          - Supprimer la liaison PC0 (fa0) --> Routeur (fa/00)
          - Ajouter la liaison PC0 (fa0) --> Switch0 (fa0/1)
          - Ajouter la liaison Routeur (fa/00) —> Switch0 (fa0/24)
    - Passer en mode Realtime:
      - Accélérer le temps
  - **Tester**:
    - Passer PC0 en mode DHCP:
      - Passer en mode Simulation
      - [PC0 >> Desktop >> IP configuration] Toggle Static --> DHCP pour déclencher une requête DHCP (action physique de l'utilisateur) 
      - Observer l'enchainement des paquets jusqu'à ce que PC0 obtienne une IP dans le range spécifié par le serveur DHCP
      - Re-passer en mode Realtime
  - Ajouter une machine:
    - Ajouter un PC nommé PC1
    - Créer la liaison:
      - Ajouter la liaison PC1 (fa0) --> Switch0 (fa0/2)
  - **Tester**:
    - Passer PC1 en mode DHCP:
      - Passer en mode Simulation
      - [PC1 >> Desktop >> IP configuration] Toggle Static --> DHCP pour déclencher une requête DHCP (action physique de l'utilisateur) 
      - Observer l'enchainement des paquets jusqu'à ce que PC1 obtienne une IP dans le range spécifié par le serveur DHCP
      - Re-passer en mode Realtime
  - Répartir les ordinateurs dans des vlan distincts:
    - Switch >> CLI:
      - [Switch >> CLI] `en`
      - [Switch >> CLI] `conf t`
      - PC0:
        - [Switch >> CLI] `vlan 10`
        - [Switch >> CLI] `int fa0/1`
        - [Switch >> CLI] `sw mode access`
        - [Switch >> CLI] `sw access vlan 10`
        - [Switch >> CLI] `exit`
      - PC1:
        - [Switch >> CLI] `vlan 20`
        - [Switch >> CLI] `int fa0/2`
        - [Switch >> CLI] `sw mode access`
        - [Switch >> CLI] `sw access vlan 20`
        - [Switch >> CLI] `exit`
      - Passer le switch en mode trunk:
        - [Switch >> CLI] `int fa0/24`
        - [Switch >> CLI] `sw mode trunk`
        - [Switch >> CLI] `sw trunk allowed vlan 10,20`
    - Passer le routeur en mode trunk:
      - Router >> CLI:
        - [Router >> CLI] `interface fa0/0`
        - [Router >> CLI] `no ip address`
        - [Router >> CLI] `no shut`
        - [Router >> CLI] `interface Fa0/0.10`
        - [Router >> CLI] `encapsulation dot1q 10`
        - [Router >> CLI] `ip helper-address 192.168.1.2`
        - [Router >> CLI] `exit`
        - [Router >> CLI] `interface Fa0/0.20`
        - [Router >> CLI] `encapsulation dot1q 20`
        - [Router >> CLI] `ip helper-address 192.168.1.2`
        - [Router >> CLI] `exit`
      - Passer en mode Realtime:
        - Accélérer le temps
  - Donner des IP aux sous-interfaces vlan du routeur:
    - Router >> CLI:
      - [Router >> CLI] `en`
      - [Router >> CLI] `conf t`
      - [Router >> CLI] `interface Fa0/0.10`
      - [Router >> CLI] `ip address 192.168.10.1 255.255.255.0`
      - [Router >> CLI] `interface Fa0/0.20`
      - [Router >> CLI] `ip address 172.16.10.1 255.255.0.0`
  - Créer 1 pool d'adresse DHCP par vlan:
        - vlan 10:
          - DHCP >> Service >> DHCP:
            - [DHCP >> Services >> DHCP] Pool name Pool1
            - [DHCP >> Services >> DHCP] Start IP Address `192.168.10.2` `255.255.255.0`
        - vlan 20:
          - DHCP >> Service >> DHCP:
            - [DHCP >> Services >> DHCP] Pool name Pool2
            - [DHCP >> Services >> DHCP] Start IP Address `172.16.10.2` `255.255.0.0`
  - **Tester**:
    - Passer PC0 en mode DHCP:
      - Passer en mode Simulation
      - [PC0 >> Desktop >> IP configuration] Toggle Static --> DHCP pour déclencher une requête DHCP (action physique de l'utilisateur) 
      - Observer l'enchainement des paquets jusqu'à ce que PC0 obtienne une IP dans le range spécifié par le serveur DHCP (exemple, 192.168.10.2)
      - Re-passer en mode Realtime
    - Passer PC1 en mode DHCP:
      - Passer en mode Simulation
      - [PC1 >> Desktop >> IP configuration] Toggle Static --> DHCP pour déclencher une requête DHCP (action physique de l'utilisateur) 
      - Observer l'enchainement des paquets jusqu'à ce que PC1 obtienne une IP dans le range spécifié par le serveur DHCP (exemple, 172.16.10.2)
      - Re-passer en mode Realtime
  - **Test succeed 7/8**:
    - **Test failed 1/8***:
      - L'ip attribuée à PC1 devrait être `172.16.10.2/16` mais elle est à `172.16.10.2/24`
    - Résolution:
      - ?

Trouble shooting:
  - Observer l'Event List du Simulation Panel gauche:
    - cliquer sur un paquet, puis `next layer` jusqu'à la fin de la trame pour observer d'eventuelles erreurs
  - Router0 >> CLI:
    - [Router0 >> CLI] `en`
    - [Router0 >> CLI] `sh run`
  - accélérer le temps
  - re-démarrer packet tracer
